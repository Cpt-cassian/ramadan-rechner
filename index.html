<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan 1447 ¬∑ Fastenzeiten Schweiz</title>

    <!-- ‚ïê‚ïê‚ïê CACHE-KONTROLLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Verhindert dass Browser/Handys eine veraltete Version
         einfrieren. Wichtig f√ºr PWA-Updates.
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma"        content="no-cache">
    <meta http-equiv="Expires"       content="0">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='110' fill='%231c1008'/><circle cx='256' cy='108' r='58' fill='%23c9913a'/><circle cx='280' cy='94' r='49' fill='%231c1008'/><polygon points='303,76 307,89 321,89 310,97 314,110 303,102 292,110 296,97 285,89 299,89' fill='%23c9913a'/><ellipse cx='256' cy='282' rx='70' ry='66' fill='%23c9913a'/><rect x='186' y='279' width='140' height='10' fill='%231c1008'/><ellipse cx='163' cy='315' rx='37' ry='33' fill='%23c9913a'/><rect x='126' y='312' width='74' height='8' fill='%231c1008'/><ellipse cx='349' cy='315' rx='37' ry='33' fill='%23c9913a'/><rect x='312' y='312' width='74' height='8' fill='%231c1008'/><rect x='198' y='288' width='116' height='142' rx='4' fill='%23c9913a'/><rect x='126' y='320' width='74' height='110' rx='3' fill='%23c9913a'/><rect x='312' y='320' width='74' height='110' rx='3' fill='%23c9913a'/><rect x='104' y='212' width='20' height='115' rx='4' fill='%23c9913a'/><ellipse cx='114' cy='209' rx='13' ry='16' fill='%23c9913a'/><rect x='110' y='188' width='8' height='26' rx='2' fill='%23d4a050'/><polygon points='114,172 119,190 109,190' fill='%23d4a050'/><rect x='388' y='212' width='20' height='115' rx='4' fill='%23c9913a'/><ellipse cx='398' cy='209' rx='13' ry='16' fill='%23c9913a'/><rect x='394' y='188' width='8' height='26' rx='2' fill='%23d4a050'/><polygon points='398,172 403,190 393,190' fill='%23d4a050'/><rect x='228' y='358' width='56' height='72' rx='28' fill='%231c1008'/><rect x='140' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='164' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='330' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='354' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='82' y='428' width='348' height='10' rx='5' fill='%23c9913a' opacity='0.4'/></svg>">

    <!-- PWA Manifest (inline als data-URL) -->
    <link rel="manifest" href="data:application/manifest+json,{
        %22name%22:%22Fastenzeiten%22,
        %22short_name%22:%22Fastenzeiten%22,
        %22description%22:%22Imsak%20%26%20Iftar%20Zeiten%20f%C3%BCr%20die%20Schweiz%22,
        %22start_url%22:%22.%22,
        %22display%22:%22standalone%22,
        %22background_color%22:%221c1008%22,
        %22theme_color%22:%221c1008%22,
        %22orientation%22:%22portrait%22,
        %22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='110' fill='%25231c1008'/><circle cx='256' cy='108' r='58' fill='%2523c9913a'/><circle cx='280' cy='94' r='49' fill='%25231c1008'/><polygon points='303,76 307,89 321,89 310,97 314,110 303,102 292,110 296,97 285,89 299,89' fill='%2523c9913a'/><ellipse cx='256' cy='282' rx='70' ry='66' fill='%2523c9913a'/><rect x='186' y='279' width='140' height='10' fill='%25231c1008'/><ellipse cx='163' cy='315' rx='37' ry='33' fill='%2523c9913a'/><rect x='126' y='312' width='74' height='8' fill='%25231c1008'/><ellipse cx='349' cy='315' rx='37' ry='33' fill='%2523c9913a'/><rect x='312' y='312' width='74' height='8' fill='%25231c1008'/><rect x='198' y='288' width='116' height='142' rx='4' fill='%2523c9913a'/><rect x='126' y='320' width='74' height='110' rx='3' fill='%2523c9913a'/><rect x='312' y='320' width='74' height='110' rx='3' fill='%2523c9913a'/><rect x='104' y='212' width='20' height='115' rx='4' fill='%2523c9913a'/><ellipse cx='114' cy='209' rx='13' ry='16' fill='%2523c9913a'/><rect x='110' y='188' width='8' height='26' rx='2' fill='%2523d4a050'/><polygon points='114,172 119,190 109,190' fill='%2523d4a050'/><rect x='388' y='212' width='20' height='115' rx='4' fill='%2523c9913a'/><ellipse cx='398' cy='209' rx='13' ry='16' fill='%2523c9913a'/><rect x='394' y='188' width='8' height='26' rx='2' fill='%2523d4a050'/><polygon points='398,172 403,190 393,190' fill='%2523d4a050'/><rect x='228' y='358' width='56' height='72' rx='28' fill='%25231c1008'/><rect x='140' y='342' width='18' height='26' rx='9' fill='%25231c1008'/><rect x='164' y='342' width='18' height='26' rx='9' fill='%25231c1008'/><rect x='330' y='342' width='18' height='26' rx='9' fill='%25231c1008'/><rect x='354' y='342' width='18' height='26' rx='9' fill='%25231c1008'/><rect x='82' y='428' width='348' height='10' rx='5' fill='%2523c9913a' opacity='0.4'/></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%20maskable%22}]
    }">

    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fastenzeiten">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='110' fill='%231c1008'/><circle cx='256' cy='108' r='58' fill='%23c9913a'/><circle cx='280' cy='94' r='49' fill='%231c1008'/><polygon points='303,76 307,89 321,89 310,97 314,110 303,102 292,110 296,97 285,89 299,89' fill='%23c9913a'/><ellipse cx='256' cy='282' rx='70' ry='66' fill='%23c9913a'/><rect x='186' y='279' width='140' height='10' fill='%231c1008'/><ellipse cx='163' cy='315' rx='37' ry='33' fill='%23c9913a'/><rect x='126' y='312' width='74' height='8' fill='%231c1008'/><ellipse cx='349' cy='315' rx='37' ry='33' fill='%23c9913a'/><rect x='312' y='312' width='74' height='8' fill='%231c1008'/><rect x='198' y='288' width='116' height='142' rx='4' fill='%23c9913a'/><rect x='126' y='320' width='74' height='110' rx='3' fill='%23c9913a'/><rect x='312' y='320' width='74' height='110' rx='3' fill='%23c9913a'/><rect x='104' y='212' width='20' height='115' rx='4' fill='%23c9913a'/><ellipse cx='114' cy='209' rx='13' ry='16' fill='%23c9913a'/><rect x='110' y='188' width='8' height='26' rx='2' fill='%23d4a050'/><polygon points='114,172 119,190 109,190' fill='%23d4a050'/><rect x='388' y='212' width='20' height='115' rx='4' fill='%23c9913a'/><ellipse cx='398' cy='209' rx='13' ry='16' fill='%23c9913a'/><rect x='394' y='188' width='8' height='26' rx='2' fill='%23d4a050'/><polygon points='398,172 403,190 393,190' fill='%23d4a050'/><rect x='228' y='358' width='56' height='72' rx='28' fill='%231c1008'/><rect x='140' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='164' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='330' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='354' y='342' width='18' height='26' rx='9' fill='%231c1008'/><rect x='82' y='428' width='348' height='10' rx='5' fill='%23c9913a' opacity='0.4'/></svg>">

    <!-- Open Graph -->
    <meta property="og:type"         content="website">
    <meta property="og:title"        content="üåô Ramadan 1447 ¬∑ Fastenzeiten Schweiz">
    <meta property="og:description"  content="Imsak &amp; Iftar Zeiten f√ºr Z√ºrich, Lachen, Bern und mehr ‚Äî t√§glich aktuell.">
    <meta property="og:image"        content="https://images.unsplash.com/photo-1584551246679-0daf3d275d0f?q=85&w=1200&h=630&auto=format&fit=crop">
    <meta name="twitter:card"        content="summary_large_image">
    <meta name="theme-color"         content="#1c1008">

    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --sand:       #e8d5b0;
            --gold:       #c9913a;
            --amber:      #d4762a;
            --night:      #1c1008;
            --warm-white: #f5ede0;
            --glow:       rgba(201,145,58,0.35);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Jost', sans-serif;
            min-height: 100vh;
            background: var(--night);
            color: var(--sand);
            overflow-x: hidden;
        }
        .hero-bg {
            position: fixed; inset: 0;
            background: url('https://images.unsplash.com/photo-1584551246679-0daf3d275d0f?q=85&w=1920&auto=format&fit=crop') no-repeat center 60%/cover;
            z-index: 0;
        }
        .hero-bg::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to bottom, rgba(28,16,8,.52) 0%, rgba(28,16,8,.28) 30%, rgba(28,16,8,.62) 62%, rgba(28,16,8,.97) 100%);
        }
        .content {
            position: relative; z-index: 1;
            max-width: 480px; margin: 0 auto;
            padding: 0 20px 70px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* HEADER */
        .header { text-align: center; padding: 56px 0 36px; }
        .eyebrow { font-weight: 300; font-size: .7em; letter-spacing: 6px; text-transform: uppercase; color: var(--gold); margin-bottom: 14px; opacity: .85; }
        h1 { font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: clamp(3.6em,11vw,5.2em); line-height: .92; color: var(--warm-white); }
        h1 em { font-style: italic; color: var(--gold); }
        .header-sub { margin-top: 16px; font-size: .68em; letter-spacing: 4px; color: var(--sand); opacity: .45; text-transform: uppercase; }

        /* LIVE PANEL */
        .live-panel {
            width: 100%;
            background: rgba(20,11,4,.65); backdrop-filter: blur(22px); -webkit-backdrop-filter: blur(22px);
            border: 1px solid rgba(201,145,58,.22); border-radius: 22px;
            padding: 28px 22px 20px; margin-bottom: 16px;
            position: relative; overflow: hidden;
        }
        .live-panel::before {
            content: ''; position: absolute; top: 0; left: 20%; right: 20%;
            height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent); opacity: .7;
        }
        .times-row { display: grid; grid-template-columns: 1fr 1px 1fr; align-items: center; margin-bottom: 20px; }
        .time-block { text-align: center; padding: 0 12px; }
        .time-label { font-size: .6em; letter-spacing: 3.5px; text-transform: uppercase; color: var(--gold); opacity: .75; margin-bottom: 7px; display: block; }
        .time-value { font-family: 'Cormorant Garamond', serif; font-size: 3.1em; color: var(--warm-white); line-height: 1; }
        .time-sep { width: 1px; height: 52px; background: linear-gradient(to bottom, transparent, rgba(201,145,58,.35), transparent); }
        .countdown-wrap {
            background: rgba(201,145,58,.07); border: 1px solid rgba(201,145,58,.18);
            border-radius: 13px; padding: 13px 18px;
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .cd-label { font-size: .65em; letter-spacing: 2px; text-transform: uppercase; color: var(--gold); opacity: .7; }
        .cd-target { display: block; font-size: .9em; color: var(--sand); opacity: .5; margin-top: 3px; }
        .cd-timer { font-family: 'Cormorant Garamond', serif; font-size: 2.05em; color: var(--gold); letter-spacing: 2px; font-variant-numeric: tabular-nums; text-shadow: 0 0 18px var(--glow); white-space: nowrap; }

        /* CONTROLS */
        .controls { width: 100%; display: flex; gap: 10px; margin-bottom: 14px; }
        .select-wrap { flex: 1; position: relative; }
        .select-wrap::after { content: '‚ñæ'; position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--gold); pointer-events: none; font-size: .78em; opacity: .8; }
        select {
            width: 100%; appearance: none; -webkit-appearance: none;
            background: rgba(20,11,4,.75); border: 1px solid rgba(201,145,58,.28);
            border-radius: 13px; color: var(--sand); font-family: 'Jost', sans-serif;
            font-size: .87em; font-weight: 300; padding: 13px 36px 13px 16px; cursor: pointer; outline: none;
        }
        select option { background: #2a1508; }
        select optgroup { background: #1c1008; color: rgba(201,145,58,0.6); font-size: 0.85em; }

        /* METHOD TOGGLE */
        .method-toggle {
            width: 100%; display: grid; grid-template-columns: 1fr 1fr;
            background: rgba(20,11,4,.75); border: 1px solid rgba(201,145,58,.22);
            border-radius: 13px; overflow: hidden; margin-bottom: 26px;
        }
        .method-btn {
            padding: 12px 10px; background: transparent; border: none;
            border-right: 1px solid rgba(201,145,58,.14);
            color: rgba(232,213,176,.35); font-family: 'Jost', sans-serif;
            font-size: .72em; font-weight: 300; cursor: pointer; transition: all .25s; line-height: 1.6; text-align: center;
        }
        .method-btn:last-child { border-right: none; }
        .method-btn strong { display: block; font-weight: 500; font-size: 1.08em; margin-bottom: 1px; }
        .method-btn.active { background: linear-gradient(135deg,rgba(201,145,58,.18),rgba(176,92,32,.12)); color: var(--sand); }
        .method-btn.active strong { color: var(--gold); }

        /* CHART */
        .chart-section { width: 100%; margin-bottom: 26px; }
        .section-title { font-family: 'Cormorant Garamond', serif; font-weight: 300; font-style: italic; font-size: 1.4em; color: var(--gold); margin-bottom: 14px; padding-left: 2px; }
        .chart-wrap {
            width: 100%;
            background: rgba(20,11,4,.65); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(201,145,58,.18); border-radius: 18px;
            padding: 20px 16px 12px; position: relative;
        }
        .chart-wrap canvas { width: 100% !important; display: block; }
        .chart-legend {
            display: flex; gap: 16px; justify-content: center;
            margin-top: 12px; font-size: .65em; letter-spacing: 1.5px; text-transform: uppercase; opacity: .6;
        }
        .leg-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; vertical-align: middle; }

        /* CALENDAR */
        .cal-title { width: 100%; font-family: 'Cormorant Garamond', serif; font-weight: 300; font-style: italic; font-size: 1.4em; color: var(--gold); margin-bottom: 12px; padding-left: 2px; }
        .cal-header { width: 100%; display: grid; grid-template-columns: 96px 1fr 1fr 1fr; gap: 4px; padding: 5px 14px; font-size: .55em; letter-spacing: 3px; text-transform: uppercase; color: var(--gold); opacity: .5; margin-bottom: 4px; }
        .cal-header span:nth-child(n+2) { text-align: center; }
        .cal-grid { width: 100%; display: flex; flex-direction: column; gap: 4px; }
        .cal-row { display: grid; grid-template-columns: 96px 1fr 1fr 1fr; gap: 4px; padding: 10px 14px; border-radius: 11px; background: rgba(201,145,58,.04); border: 1px solid rgba(201,145,58,.07); transition: background .18s, border-color .18s; }
        .cal-row:hover { background: rgba(201,145,58,.09); border-color: rgba(201,145,58,.18); }
        .cal-row.today { background: linear-gradient(135deg,rgba(201,145,58,.17),rgba(176,92,32,.10)); border-color: rgba(201,145,58,.42); }
        .cal-row.past { opacity: .33; }
        .cal-date { display: flex; flex-direction: column; justify-content: center; }
        .cal-weekday { font-size: .62em; letter-spacing: 1.5px; color: var(--gold); opacity: .65; text-transform: uppercase; }
        .cal-datenum { font-family: 'Cormorant Garamond', serif; font-size: 1.08em; color: var(--warm-white); line-height: 1.25; display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        .today-pill { font-family: 'Jost', sans-serif; font-size: .45em; font-weight: 500; letter-spacing: 2px; text-transform: uppercase; background: var(--gold); color: var(--night); padding: 2px 7px; border-radius: 20px; }
        .cal-time { font-family: 'Cormorant Garamond', serif; font-size: 1.22em; color: var(--sand); text-align: center; display: flex; align-items: center; justify-content: center; }
        .cal-duration { font-size: .78em; color: var(--gold); opacity: .7; text-align: center; display: flex; align-items: center; justify-content: center; letter-spacing: .5px; }
        .cal-row.today .cal-time { color: var(--warm-white); }
        .cal-row.today .cal-duration { opacity: 1; }

        /* PWA INSTALL BANNER */
        .install-banner {
            width: 100%; margin-bottom: 16px;
            background: rgba(201,145,58,.1); border: 1px solid rgba(201,145,58,.3);
            border-radius: 14px; padding: 14px 18px;
            display: flex; align-items: center; gap: 14px;
            cursor: pointer; transition: background .2s;
        }
        .install-banner:hover { background: rgba(201,145,58,.16); }
        .install-icon { font-size: 1.8em; flex-shrink: 0; }
        .install-text strong { display: block; font-size: .88em; font-weight: 500; color: var(--warm-white); margin-bottom: 2px; }
        .install-text span { font-size: .7em; color: var(--sand); opacity: .6; letter-spacing: .5px; }
        .install-btn {
            margin-left: auto; flex-shrink: 0;
            background: var(--gold); color: var(--night);
            border: none; border-radius: 8px;
            font-family: 'Jost', sans-serif; font-size: .72em; font-weight: 500;
            letter-spacing: 1px; padding: 7px 14px; cursor: pointer; white-space: nowrap;
        }

        .lang-toggle {
            width: 100%; display: grid; grid-template-columns: 1fr 1fr;
            background: rgba(20,11,4,.6); border: 1px solid rgba(201,145,58,.18);
            border-radius: 11px; overflow: hidden; margin-bottom: 20px;
        }
        .lang-btn {
            padding: 9px 10px; background: transparent; border: none;
            border-right: 1px solid rgba(201,145,58,.12);
            color: rgba(232,213,176,.35); font-family: 'Jost', sans-serif;
            font-size: .78em; font-weight: 300; cursor: pointer; transition: all .2s;
            letter-spacing: 1px;
        }
        .lang-btn:last-child { border-right: none; }
        .lang-btn.active { background: rgba(201,145,58,.14); color: var(--gold); font-weight: 500; }
        /* iOS INSTALL POPUP */
        .ios-popup {
            position: fixed;
            bottom: 24px; left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 440px;
            background: rgba(20,11,4,0.97);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(201,145,58,0.45);
            border-radius: 20px;
            padding: 20px 20px 16px;
            z-index: 9999;
            box-shadow: 0 8px 40px rgba(0,0,0,0.6), 0 0 0 1px rgba(201,145,58,0.1);
            animation: slideUp 0.35s cubic-bezier(0.34,1.56,0.64,1);
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(30px); opacity: 0; }
            to   { transform: translateX(-50%) translateY(0);    opacity: 1; }
        }
        .ios-popup::after {
            content: '';
            position: absolute;
            bottom: -10px; left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid rgba(201,145,58,0.45);
        }
        .ios-popup-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15em;
            font-weight: 400;
            color: var(--warm-white);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .ios-popup-title span { font-size: 1.3em; }
        .ios-popup-steps {
            font-size: 0.8em;
            color: var(--sand);
            opacity: 0.75;
            line-height: 1.9;
            letter-spacing: 0.3px;
        }
        .ios-popup-steps strong { color: var(--gold); font-weight: 500; }
        .ios-popup-close {
            position: absolute;
            top: 12px; right: 14px;
            background: none; border: none;
            color: rgba(201,145,58,0.5);
            font-size: 1.1em; cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: color 0.2s;
        }
        .ios-popup-close:hover { color: var(--gold); }

        .footer-note { margin-top: 30px; font-size: .62em; letter-spacing: 1.5px; color: var(--sand); opacity: .25; text-align: center; }

        @media (max-width: 400px) {
            h1 { font-size: 3.2em; }
            .time-value { font-size: 2.6em; }
            .cd-timer { font-size: 1.75em; }
            .cal-row, .cal-header { padding-left: 10px; padding-right: 10px; }
        }
    </style>
</head>
<body>

<div class="hero-bg"></div>

<!-- iOS INSTALL POPUP (wird per JS eingeblendet) -->
<div class="ios-popup" id="ios-popup" style="display:none">
    <button class="ios-popup-close" onclick="document.getElementById('ios-popup').style.display='none'">‚úï</button>
    <div class="ios-popup-title"><span>üì≤</span> <span id="ios-popup-title-text">Auf Homescreen speichern</span></div>
    <div class="ios-popup-steps" id="ios-popup-steps">
        1. Tippe unten auf <strong>Teilen</strong> ‚¨Ü<br>
        2. Scrolle und tippe <strong>‚ÄûZum Home-Bildschirm"</strong> Ôºã<br>
        3. Tippe oben rechts auf <strong>‚ÄûHinzuf√ºgen"</strong>
    </div>
</div>
<div class="content">

    <div class="header">
        <div class="eyebrow" data-i18n="eyebrow">Ramadan 1447 ¬∑ Schweiz</div>
        <h1 id="main-title">Agje<em>rimi</em></h1>
        <div class="header-sub" data-i18n="dates">19. Februar ‚Äì 19. M√§rz 2026</div>
    </div>

    <!-- PWA INSTALL BANNER (wird per JS eingeblendet falls installierbar) -->
    <div class="install-banner" id="install-banner" style="display:none" onclick="pwaInstall()">
        <div class="install-icon">üì≤</div>
        <div class="install-text">
            <strong data-i18n="install_title">Als App installieren</strong>
            <span data-i18n="install_sub">Direkt auf dem Homescreen speichern</span>
        </div>
        <button class="install-btn" data-i18n="install_btn">Installieren</button>
    </div>

    <!-- LIVE -->
    <div class="live-panel">
        <div class="times-row">
            <div class="time-block">
                <span class="time-label" data-i18n="imsak">Imsak</span>
                <div class="time-value" id="imsak-zeit">--:--</div>
            </div>
            <div class="time-sep"></div>
            <div class="time-block">
                <span class="time-label" data-i18n="iftar">Iftar</span>
                <div class="time-value" id="iftar-zeit">--:--</div>
            </div>
        </div>
        <div class="countdown-wrap">
            <div class="cd-label"><span data-i18n="remaining">Verbleibend</span><span class="cd-target" id="cd-ziel">deri Imsak</span></div>
            <div class="cd-timer" id="cd-uhr">--:--:--</div>
        </div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
        <div class="select-wrap">
            <select id="stadt-auswahl" onchange="berechne()">
                <optgroup label="Z√ºrich &amp; Umgebung">
                    <option value="z√ºrich">Z√ºrich</option>
                    <option value="winterthur">Winterthur</option>
                    <option value="rapperswil">Rapperswil</option>
                    <option value="uster">Uster</option>
                    <option value="dietikon">Dietikon</option>
                    <option value="regensdorf">Regensdorf</option>
                    <option value="schlieren">Schlieren</option>
                    <option value="kloten">Kloten</option>
                    <option value="d√ºbendorf">D√ºbendorf</option>
                    <option value="wettingen">Wettingen</option>
                </optgroup>
                <optgroup label="Innerschweiz">
                    <option value="lachen" selected>Lachen (SZ)</option>
                    <option value="schwyz">Schwyz</option>
                    <option value="zug">Zug</option>
                    <option value="luzern">Luzern</option>
                    <option value="k√ºssnacht">K√ºssnacht</option>
                    <option value="arth">Arth</option>
                    <option value="pf√§ffikon">Pf√§ffikon (SZ)</option>
                    <option value="altendorf">Altendorf</option>
                </optgroup>
                <optgroup label="Bern &amp; Umgebung">
                    <option value="bern">Bern</option>
                    <option value="biel">Biel/Bienne</option>
                    <option value="thun">Thun</option>
                    <option value="burgdorf">Burgdorf</option>
                    <option value="k√∂niz">K√∂niz</option>
                </optgroup>
                <optgroup label="Basel &amp; Aargau">
                    <option value="basel">Basel</option>
                    <option value="aarau">Aarau</option>
                    <option value="olten">Olten</option>
                    <option value="sissach">Sissach</option>
                    <option value="rheinfelden">Rheinfelden</option>
                </optgroup>
                <optgroup label="Ostschweiz">
                    <option value="stgallen">St. Gallen</option>
                    <option value="schaffhausen">Schaffhausen</option>
                    <option value="frauenfeld">Frauenfeld</option>
                    <option value="kreuzlingen">Kreuzlingen</option>
                    <option value="arbon">Arbon</option>
                </optgroup>
                <optgroup label="Westschweiz">
                    <option value="genf">Genf</option>
                    <option value="lausanne">Lausanne</option>
                    <option value="freiburg">Freiburg</option>
                    <option value="yverdon">Yverdon</option>
                    <option value="renens">Renens</option>
                </optgroup>
                <optgroup label="Tessin">
                    <option value="lugano">Lugano</option>
                    <option value="bellinzona">Bellinzona</option>
                    <option value="locarno">Locarno</option>
                </optgroup>
                <optgroup label="Graub√ºnden &amp; Wallis">
                    <option value="chur">Chur</option>
                    <option value="sion">Sion/Sitten</option>
                </optgroup>
            </select>
        </div>
    </div>

    <!-- METHOD -->
    <div class="method-toggle">
        <button class="method-btn active" id="btn-daigs" onclick="setMethod('daigs')">
            <strong>üïå DAIGS / FIDS</strong><span data-i18n="m_daigs_sub">Albanisch ¬∑ 18¬∞ ¬∑ +7 Min</span>
        </button>
        <button class="method-btn" id="btn-izr" onclick="setMethod('izr')">
            <strong>üá®üá≠ IZR Schweiz</strong><span data-i18n="m_izr_sub">Zentralrat ¬∑ 12.5¬∞ ¬∑ +5 Min</span>
        </button>
    </div>

    <!-- SPRACHE -->
    <div class="lang-toggle">
        <button class="lang-btn" id="btn-de" onclick="setLang('de')">üá©üá™ Deutsch</button>
        <button class="lang-btn active" id="btn-sq" onclick="setLang('sq')">üá¶üá± Shqip</button>
    </div>

    <!-- CHART -->
    <div class="chart-section">
        <div class="section-title" data-i18n="chart_title">Fastenverlauf</div>
        <div class="chart-wrap">
            <canvas id="fastenchart" height="160"></canvas>
            <div class="chart-legend">
                <span><span class="leg-dot" style="background:#c9913a"></span>Imsak</span>
                <span><span class="leg-dot" style="background:#7a4a2e"></span>Iftar</span>
                <span><span class="leg-dot" style="background:rgba(201,145,58,.25)"></span><span data-i18n="duration">Fastendauer</span></span>
            </div>
        </div>
    </div>

    <!-- CALENDAR -->
    <div class="cal-title" data-i18n="cal_title">Kalender Ramadan 2026</div>
    <div class="cal-header">
        <span data-i18n="col_date">Datum</span><span data-i18n="imsak">Imsak</span><span data-i18n="iftar">Iftar</span><span data-i18n="col_dur">Dauer</span>
    </div>
    <div class="cal-grid" id="kalender"></div>

    <div class="footer-note" data-i18n="footer">Astronomisch berechnet ¬∑ verifiziert ¬±1 Min</div>
</div>

<script>
// ================================================================
// DATEN
// ================================================================
// ================================================================
// VERSION & UPDATE-ERKENNUNG
// ================================================================
var APP_VERSION = '2026-02-22-v4'; // ‚Üê Diese Zahl bei jedem Update √§ndern!

(function checkVersion() {
    try {
        var stored = localStorage.getItem('app_version');
        if (stored && stored !== APP_VERSION) {
            // Neue Version erkannt ‚Üí Seite einmal hard-reloaden
            localStorage.setItem('app_version', APP_VERSION);
            window.location.reload(true);
            return;
        }
        localStorage.setItem('app_version', APP_VERSION);
    } catch(e) {}
})();

// ================================================================
// √úBERSETZUNGEN
// ================================================================
var LANG = 'sq';
var I18N = {
    de: {
        eyebrow:        'Ramadan 1447 ¬∑ Schweiz',
        dates:          '19. Februar ‚Äì 19. M√§rz 2026',
        install_title:  'Als App installieren',
        install_sub:    'Direkt auf dem Homescreen speichern',
        install_btn:    'Installieren',
        install_ios_title: 'Auf Homescreen hinzuf√ºgen',
        install_ios_sub:   'Tippe auf Teilen ‚Üí ‚ÄûZum Home-Bildschirm"',
        imsak:          'Imsak',
        iftar:          'Iftar',
        remaining:      'Verbleibend',
        cd_imsak_today: 'bis Imsak ¬∑ heute',
        cd_iftar_today: 'bis Iftar ¬∑ heute',
        cd_imsak_tom:   'bis Imsak ¬∑ morgen',
        chart_title:    'Fastenverlauf',
        cal_title:      'Kalender Ramadan 2026',
        col_date:       'Datum',
        col_dur:        'Dauer',
        duration:       'Fastendauer',
        today_pill:     'Heute',
        footer:         'Astronomisch berechnet ¬∑ verifiziert ¬±1 Min',
        m_daigs_sub:    'Albanisch ¬∑ 18¬∞ ¬∑ +7 Min',
        m_izr_sub:      'Zentralrat ¬∑ 12.5¬∞ ¬∑ +5 Min',
        optgroups: {
            'Z√ºrich & Umgebung': 'Z√ºrich & Umgebung',
            'Innerschweiz': 'Innerschweiz',
            'Bern & Umgebung': 'Bern & Umgebung',
            'Basel & Aargau': 'Basel & Aargau',
            'Ostschweiz': 'Ostschweiz',
            'Westschweiz': 'Westschweiz',
            'Tessin': 'Tessin',
            'Graub√ºnden & Wallis': 'Graub√ºnden & Wallis'
        }
    },
    sq: {
        eyebrow:        'Ramazani 1447 ¬∑ Zvic√´r',
        dates:          '19 Shkurt ‚Äì 19 Mars 2026',
        install_title:  'Instalo si aplikacion',
        install_sub:    'Ruaje direkt n√´ ekranin kryesor',
        install_btn:    'Instalo',
        install_ios_title: 'Shto n√´ ekranin kryesor',
        install_ios_sub:   'Shtyp Ndaj ‚Üí ‚ÄûShto n√´ ekran kryesor"',
        imsak:          'Imsaku',
        iftar:          'Iftari',
        remaining:      'Koha e mbetur',
        cd_imsak_today: 'deri Imsak ¬∑ sot',
        cd_iftar_today: 'deri Iftar ¬∑ sot',
        cd_imsak_tom:   'deri Imsak ¬∑ nes√´r',
        chart_title:    'Ecuria e agj√´rimit',
        cal_title:      'Kalendari i Ramazanit 2026',
        col_date:       'Data',
        col_dur:        'Koh√´zgjatja',
        duration:       'Koh√´zgjatja',
        today_pill:     'Sot',
        footer:         'Llogaritur astronomikisht ¬∑ verifikuar ¬±1 min',
        m_daigs_sub:    'Shqiptar ¬∑ 18¬∞ ¬∑ +7 min',
        m_izr_sub:      'K√´shilli Qendror ¬∑ 12.5¬∞ ¬∑ +5 min',
        optgroups: {
            'Z√ºrich & Umgebung': 'Cyrih & rrethin√´',
            'Innerschweiz': 'Zvicra e Brendshme',
            'Bern & Umgebung': 'Bern & rrethin√´',
            'Basel & Aargau': 'Basel & Aargau',
            'Ostschweiz': 'Zvicra Lindore',
            'Westschweiz': 'Zvicra Per√´ndimore',
            'Tessin': 'Ticino',
            'Graub√ºnden & Wallis': 'Graub√ºnden & Valais'
        }
    }
};
function T(key) { return (I18N[LANG] && I18N[LANG][key]) ? I18N[LANG][key] : I18N['de'][key]; }

function applyLang() {
    // H1 Titel
    var t = document.getElementById('main-title');
    if(t) t.innerHTML = LANG==='sq' ? 'Agje<em>rimi</em>' : 'Fasten<em>zeiten</em>';
    // Alle data-i18n Elemente aktualisieren
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
        el.textContent = T(el.getAttribute('data-i18n'));
    });
    // optgroups √ºbersetzen
    document.querySelectorAll('#stadt-auswahl optgroup').forEach(function(og) {
        var label = og.getAttribute('label').replace('&amp;','&');
        og.label = T('optgroups')[label] || label;
    });
    // html lang
    document.documentElement.lang = LANG;
}

function setLang(lang) {
    LANG = lang;
    document.getElementById('btn-de').className = 'lang-btn' + (lang==='de'?' active':'');
    document.getElementById('btn-sq').className = 'lang-btn' + (lang==='sq'?' active':'');
    applyLang();
    berechne(); // Kalender + Countdown neu rendern (heute-pill etc.)
}

var ORTE = {
    // Z√ºrich & Umgebung
    "z√ºrich":       {lat:47.3769,lon:8.5417},
    "winterthur":   {lat:47.4988,lon:8.7269},
    "rapperswil":   {lat:47.2262,lon:8.8183},
    "uster":        {lat:47.3478,lon:8.7200},
    "dietikon":     {lat:47.4028,lon:8.3997},
    "regensdorf":   {lat:47.4333,lon:8.4667},
    "schlieren":    {lat:47.3978,lon:8.4481},
    "kloten":       {lat:47.4500,lon:8.5833},
    "d√ºbendorf":    {lat:47.3953,lon:8.6178},
    "wettingen":    {lat:47.4667,lon:8.3167},
    // Innerschweiz
    "lachen":       {lat:47.1915,lon:8.8580},
    "schwyz":       {lat:47.0207,lon:8.6537},
    "zug":          {lat:47.1662,lon:8.5155},
    "luzern":       {lat:47.0502,lon:8.3093},
    "k√ºssnacht":    {lat:47.0833,lon:8.4333},
    "arth":         {lat:47.0622,lon:8.5181},
    "pf√§ffikon":    {lat:47.2044,lon:8.7773},
    "altendorf":    {lat:47.1881,lon:8.8339},
    // Bern & Umgebung
    "bern":         {lat:46.9480,lon:7.4474},
    "biel":         {lat:47.1372,lon:7.2468},
    "thun":         {lat:46.7580,lon:7.6280},
    "burgdorf":     {lat:47.0572,lon:7.6233},
    "k√∂niz":        {lat:46.9167,lon:7.4167},
    // Basel & Aargau
    "basel":        {lat:47.5596,lon:7.5886},
    "aarau":        {lat:47.3923,lon:8.0444},
    "olten":        {lat:47.3524,lon:7.9077},
    "sissach":      {lat:47.4667,lon:7.8167},
    "rheinfelden":  {lat:47.5578,lon:7.7933},
    // Ostschweiz
    "stgallen":     {lat:47.4245,lon:9.3767},
    "schaffhausen": {lat:47.6960,lon:8.6348},
    "frauenfeld":   {lat:47.5583,lon:8.8983},
    "kreuzlingen":  {lat:47.6500,lon:9.1667},
    "arbon":        {lat:47.5167,lon:9.4333},
    // Westschweiz
    "genf":         {lat:46.2044,lon:6.1432},
    "lausanne":     {lat:46.5197,lon:6.6323},
    "freiburg":     {lat:46.8066,lon:7.1618},
    "yverdon":      {lat:46.7785,lon:6.6408},
    "renens":       {lat:46.5333,lon:6.5833},
    // Tessin
    "lugano":       {lat:46.0037,lon:8.9511},
    "bellinzona":   {lat:46.1956,lon:9.0194},
    "locarno":      {lat:46.1706,lon:8.7997},
    // Graub√ºnden & Wallis
    "chur":         {lat:46.8508,lon:9.5325},
    "sion":         {lat:46.2333,lon:7.3601}
};
var ORTE_BASEL = {lat:47.5596,lon:7.5886}; ORTE.basel = ORTE_BASEL;
var WD = ['So','Mo','Di','Mi','Do','Fr','Sa'];
var MO = ['Jan','Feb','M√§r','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'];
var RAMADAN_START = new Date(2026,1,19);
var RAMADAN_ENDE  = new Date(2026,2,19);
var METHODEN = {
    daigs: {fajrAngle:function(){return 18;}, imsakOffset:0, maghribOffset:7},
    izr:   {fajrAngle:function(d){var m=d.getMonth()+1;return(m>3&&m<10)?13:12.5;}, imsakOffset:0, maghribOffset:5}
};
var aktuelleMethode = 'daigs';
var timerInterval;
var chartInstanz = null;
var pwaPrompt = null;

// ================================================================
// ASTRONOMIE
// ================================================================
function julianDay(Y,M,D){if(M<=2){Y--;M+=12;}var A=Math.floor(Y/100),B=2-A+Math.floor(A/4);return Math.floor(365.25*(Y+4716))+Math.floor(30.6001*(M+1))+D+B-1524.5;}
function sunParams(JD){var n=JD-2451545;var g=((357.529+0.98560028*n)%360+360)%360;var q=((280.459+0.98564736*n)%360+360)%360;var L=((q+1.915*Math.sin(g*Math.PI/180)+.02*Math.sin(2*g*Math.PI/180))%360+360)%360;var e=23.439-0.00000036*n;var dec=Math.asin(Math.sin(e*Math.PI/180)*Math.sin(L*Math.PI/180));var RA=Math.atan2(Math.cos(e*Math.PI/180)*Math.sin(L*Math.PI/180),Math.cos(L*Math.PI/180))*180/Math.PI/15;RA=((RA%24)+24)%24;return{dec:dec,eqt:q/15-RA};}
function holeZeiten(datum,lat,lon){var Y=datum.getFullYear(),M=datum.getMonth()+1,D=datum.getDate();var sun=sunParams(julianDay(Y,M,D));var jan=new Date(Y,0,1).getTimezoneOffset(),jul=new Date(Y,6,1).getTimezoneOffset();var tz=(datum.getTimezoneOffset()<Math.max(jan,jul))?2:1;var noon=12-sun.eqt-lon/15+tz;function ha(a){var c=(Math.sin(a*Math.PI/180)-Math.sin(lat*Math.PI/180)*Math.sin(sun.dec))/(Math.cos(lat*Math.PI/180)*Math.cos(sun.dec));return Math.acos(Math.max(-1,Math.min(1,c)))*180/Math.PI/15;}var m=METHODEN[aktuelleMethode];var iH=noon-ha(-m.fajrAngle(datum))+m.imsakOffset/60;var fH=noon+ha(-0.833)+m.maghribOffset/60;function toDate(h){var d=new Date(datum);h=((h%24)+24)%24;var hh=Math.floor(h),mm=Math.round((h-hh)*60);if(mm===60){mm=0;hh++;}d.setHours(hh,mm,0,0);return d;}return{imsak:toDate(iH),iftar:toDate(fH)};}
function fmt(d){return String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0');}
function pad(n){return String(Math.floor(n)).padStart(2,'0');}
function dauerStr(imsak,iftar){var min=Math.round((iftar-imsak)/60000);var h=Math.floor(min/60),m=min%60;return h+'h'+String(m).padStart(2,'0');}
function hToDecimal(d){return d.getHours()+d.getMinutes()/60;}

// ================================================================
// CHART
// ================================================================
function renderChart(coords) {
    var labels=[], imsakData=[], iftarData=[], dauerData=[];
    var cursor=new Date(RAMADAN_START);
    while(cursor<=RAMADAN_ENDE){
        var t=holeZeiten(cursor,coords.lat,coords.lon);
        labels.push(cursor.getDate()+'. '+MO[cursor.getMonth()]);
        imsakData.push(+hToDecimal(t.imsak).toFixed(3));
        iftarData.push(+hToDecimal(t.iftar).toFixed(3));
        var dur=Math.round((t.iftar-t.imsak)/60000)/60;
        dauerData.push(+dur.toFixed(3));
        cursor=new Date(cursor.getFullYear(),cursor.getMonth(),cursor.getDate()+1);
    }

    if(chartInstanz){chartInstanz.destroy();}
    var ctx=document.getElementById('fastenchart').getContext('2d');

    // Heute-Index
    var heute=new Date();
    var heuteIdx=-1;
    var c2=new Date(RAMADAN_START);
    var idx=0;
    while(c2<=RAMADAN_ENDE){if(c2.toDateString()===heute.toDateString())heuteIdx=idx;c2=new Date(c2.getFullYear(),c2.getMonth(),c2.getDate()+1);idx++;}

    chartInstanz = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Fastendauer (h)',
                    data: dauerData,
                    backgroundColor: function(ctx) {
                        var i=ctx.dataIndex;
                        return i===heuteIdx ? 'rgba(201,145,58,0.55)' : 'rgba(201,145,58,0.18)';
                    },
                    borderColor: function(ctx){
                        return ctx.dataIndex===heuteIdx?'rgba(201,145,58,1)':'rgba(201,145,58,0.35)';
                    },
                    borderWidth: function(ctx){return ctx.dataIndex===heuteIdx?2:1;},
                    borderRadius: 4,
                    yAxisID: 'yDauer',
                    order: 2
                },
                {
                    label: 'Imsak',
                    data: imsakData,
                    type: 'line',
                    borderColor: 'rgba(201,145,58,0.9)',
                    backgroundColor: 'transparent',
                    pointBackgroundColor: function(ctx){return ctx.dataIndex===heuteIdx?'#c9913a':'rgba(201,145,58,0.5)';},
                    pointRadius: function(ctx){return ctx.dataIndex===heuteIdx?5:2;},
                    borderWidth: 2,
                    tension: 0.4,
                    yAxisID: 'yZeit',
                    order: 1
                },
                {
                    label: 'Iftar',
                    data: iftarData,
                    type: 'line',
                    borderColor: 'rgba(122,74,46,0.9)',
                    backgroundColor: 'transparent',
                    pointBackgroundColor: function(ctx){return ctx.dataIndex===heuteIdx?'#7a4a2e':'rgba(122,74,46,0.5)';},
                    pointRadius: function(ctx){return ctx.dataIndex===heuteIdx?5:2;},
                    borderWidth: 2,
                    tension: 0.4,
                    yAxisID: 'yZeit',
                    order: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            interaction: { mode:'index', intersect:false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(20,11,4,0.92)',
                    borderColor: 'rgba(201,145,58,0.4)',
                    borderWidth: 1,
                    titleColor: '#c9913a',
                    bodyColor: '#e8d5b0',
                    padding: 10,
                    callbacks: {
                        title: function(items){ return labels[items[0].dataIndex]; },
                        label: function(item) {
                            if(item.datasetIndex===0) return ' Dauer: '+dauerData[item.dataIndex].toFixed(1)+' h';
                            var h=item.raw;
                            var hh=Math.floor(h),mm=Math.round((h-hh)*60);
                            var name=item.datasetIndex===1?'Imsak':'Iftar';
                            return ' '+name+': '+String(hh).padStart(2,'0')+':'+String(mm).padStart(2,'0');
                        }
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color:'rgba(232,213,176,0.4)',
                        font:{size:9,family:'Jost'},
                        maxRotation:45,
                        callback: function(val,i){ return i%5===0?this.getLabelForValue(val):''; }
                    },
                    grid: { color:'rgba(201,145,58,0.07)' }
                },
                yZeit: {
                    type:'linear', position:'left',
                    min:4.5, max:19.5,
                    ticks: {
                        color:'rgba(232,213,176,0.4)',
                        font:{size:9,family:'Jost'},
                        callback:function(v){var h=Math.floor(v),m=Math.round((v-h)*60);return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0');}
                    },
                    grid:{ color:'rgba(201,145,58,0.07)' }
                },
                yDauer: {
                    type:'linear', position:'right',
                    min:10, max:15,
                    ticks:{
                        color:'rgba(201,145,58,0.35)',
                        font:{size:9,family:'Jost'},
                        callback:function(v){return v+'h';}
                    },
                    grid:{ drawOnChartArea:false }
                }
            }
        }
    });
}

// ================================================================
// KALENDER
// ================================================================
function renderKalender(coords) {
    var heute=new Date(), grid=document.getElementById('kalender');
    grid.innerHTML='';
    var cursor=new Date(RAMADAN_START), todayRow=null;
    while(cursor<=RAMADAN_ENDE){
        var t=holeZeiten(cursor,coords.lat,coords.lon);
        var isToday=cursor.toDateString()===heute.toDateString();
        var isPast=cursor<heute&&!isToday;
        var row=document.createElement('div');
        row.className='cal-row'+(isToday?' today':'')+(isPast?' past':'');
        row.innerHTML=
            '<div class="cal-date"><div class="cal-weekday">'+WD[cursor.getDay()]+'</div>'+
            '<div class="cal-datenum">'+cursor.getDate()+'. '+MO[cursor.getMonth()]+
            (isToday?' <span class="today-pill">'+T('today_pill')+'</span>':'')+
            '</div></div>'+
            '<div class="cal-time">'+fmt(t.imsak)+'</div>'+
            '<div class="cal-time">'+fmt(t.iftar)+'</div>'+
            '<div class="cal-duration">'+dauerStr(t.imsak,t.iftar)+'</div>';
        grid.appendChild(row);
        if(isToday)todayRow=row;
        cursor=new Date(cursor.getFullYear(),cursor.getMonth(),cursor.getDate()+1);
    }
    if(todayRow)setTimeout(function(){todayRow.scrollIntoView({behavior:'smooth',block:'center'});},200);
}

// ================================================================
// BERECHNE
// ================================================================
function berechne() {
    clearInterval(timerInterval);
    var coords=ORTE[document.getElementById('stadt-auswahl').value];
    var heute=new Date();
    var morgen=new Date(heute.getFullYear(),heute.getMonth(),heute.getDate()+1,12,0,0);
    var zH=holeZeiten(heute,coords.lat,coords.lon);
    var zM=holeZeiten(morgen,coords.lat,coords.lon);
    document.getElementById('imsak-zeit').innerText=fmt(zH.imsak);
    document.getElementById('iftar-zeit').innerText=fmt(zH.iftar);
    function tick(){
        var now=Date.now(),target,label;
        if(now>zH.iftar.getTime()){target=zM.imsak.getTime();label=T('cd_imsak_tom');}
        else if(now>zH.imsak.getTime()){target=zH.iftar.getTime();label=T('cd_iftar_today');}
        else{target=zH.imsak.getTime();label=T('cd_imsak_today');}
        var d=Math.max(0,target-now);
        document.getElementById('cd-ziel').innerText=label;
        document.getElementById('cd-uhr').innerText=pad(Math.floor(d/3600000))+':'+pad(Math.floor((d%3600000)/60000))+':'+pad(Math.floor((d%60000)/1000));
    }
    tick(); timerInterval=setInterval(tick,1000);
    renderChart(coords);
    renderKalender(coords);
}
function setMethod(m){
    aktuelleMethode=m;
    document.getElementById('btn-daigs').className='method-btn'+(m==='daigs'?' active':'');
    document.getElementById('btn-izr').className='method-btn'+(m==='izr'?' active':'');
    berechne();
}

// ================================================================
// PWA INSTALL
// ================================================================
window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    pwaPrompt = e;
    document.getElementById('install-banner').style.display = 'flex';
});
function pwaInstall() {
    if(pwaPrompt) {
        // Android/Chrome: nativer Install-Dialog
        pwaPrompt.prompt();
        pwaPrompt.userChoice.then(function(r){
            pwaPrompt=null;
            document.getElementById('install-banner').style.display='none';
        });
    } else {
        // iOS: zeige Schritt-f√ºr-Schritt Popup
        var popup = document.getElementById('ios-popup');
        var isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
        // Texte je nach Sprache
        document.getElementById('ios-popup-title-text').innerText = T('install_ios_title');
        document.getElementById('ios-popup-steps').innerHTML = LANG==='sq'
            ? '1. Shtyp butonin <strong>Ndaj</strong> ‚¨Ü posht√´<br>2. Rrokullis dhe shtyp <strong>‚ÄûShto n√´ ekranin kryesor"</strong> Ôºã<br>3. Shtyp <strong>‚ÄûShto"</strong> lart djathtas'
            : '1. Tippe unten auf <strong>Teilen</strong> ‚¨Ü<br>2. Scrolle und tippe <strong>‚ÄûZum Home-Bildschirm"</strong> Ôºã<br>3. Tippe oben rechts auf <strong>‚ÄûHinzuf√ºgen"</strong>';
        popup.style.display = 'block';
        // Automatisch nach 8s schliessen
        setTimeout(function(){ popup.style.display='none'; }, 8000);
    }
}
// iOS: Hinweis anzeigen (iOS unterst√ºtzt beforeinstallprompt nicht)
window.addEventListener('load', function(){
    var isIOS=/iphone|ipad|ipod/i.test(navigator.userAgent);
    var isStandalone=window.navigator.standalone===true;
    if(isIOS&&!isStandalone){
        var b=document.getElementById('install-banner');
        b.style.display='flex';
        b.querySelector('.install-text strong').innerText=T('install_ios_title');
        b.querySelector('.install-text span').innerText='Tippe auf Teilen ‚Üí ‚ÄûZum Home-Bildschirm"';
        b.querySelector('.install-btn').style.display='none';
        b.style.cursor='default';
    }
});

// ================================================================
// CHART.JS laden & starten
// ================================================================
window.onload = function() {
    var s=document.createElement('script');
    s.src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js';
    s.onload=function(){ setMethod('daigs'); };
    document.head.appendChild(s);
};
</script>
</body>
</html>